---
import Layout from "../layouts/Layout.astro";
import { getArtistBySlug } from "../content/artists";
import { Image } from "astro:assets";

// Para SSR obtenemos el parámetro directamente (sin getStaticPaths)
const { slug } = Astro.params;

// Verificar que el parámetro existe
if (!slug) {
  return Astro.redirect("/");
}

// Buscar el artista por slug
const artist = getArtistBySlug(slug);

// Si no encontramos el artista, redirigir al home
if (!artist) {
  return Astro.redirect("/");
}
---

<Layout title={`${artist.name} - Olimpiada de Asadores`} textColor='text-white'>
  <!-- Botón Volver fijo debajo del nav -->
  <div
    class='fixed top-16 left-4 z-40 animate-fade-in'
    style='animation-delay: 0.8s; animation-fill-mode: both;'
  >
    <a href='/#shows' class='btn-primary inline-flex items-center gap-2'>
      <svg
        class='w-4 h-4'
        fill='none'
        stroke='currentColor'
        viewBox='0 0 24 24'
      >
        <path
          stroke-linecap='round'
          stroke-linejoin='round'
          stroke-width='2'
          d='M15 19l-7-7 7-7'></path>
      </svg>
      Volver
    </a>
  </div>

  <main class='paper-bg min-h-screen'>
    <!-- Hero Section -->
    <section
      class='relative min-h-screen flex items-center justify-center overflow-hidden'
    >
      <div class='absolute inset-0'>
        <picture>
          <source
            media='(max-width: 768px)'
            srcset={`/images/artists/mobile/${artist.slug}.webp`}
          />
          <img
            src={artist.image}
            alt={artist.name}
            class='w-full h-full object-cover animate-fade-in'
            style='animation-delay: 0.2s; animation-fill-mode: both;'
            transition:name={`artist-${artist.slug}-image`}
          />
        </picture>
        <div
          class='absolute inset-0 bg-black/60 animate-fade-in'
          style='animation-delay: 0.4s; animation-fill-mode: both;'
        >
        </div>
      </div>

      <div class='relative z-10 text-center text-white container section'>
        <h1
          class='font-title text-6xl md:text-8xl mb-4'
          transition:name={`artist-${artist.slug}-name`}
        >
          {artist.name}
        </h1>
        <p class='font-ui text-xl md:text-2xl mb-8 opacity-90'>
          {artist.genre}
          {artist.showTime && `• ${artist.showTime}`}
        </p>

        <!-- Social Media Buttons -->
        <div
          class='flex flex-wrap justify-center gap-4 animate-fade-in'
          style='animation-delay: 0.6s; animation-fill-mode: both;'
        >
          {
            artist.socialMedia.instagram &&
              (Array.isArray(artist.socialMedia.instagram) ? (
                artist.socialMedia.instagram.map((instagramHandle, index) => (
                  <a
                    href={
                      instagramHandle.startsWith("http")
                        ? instagramHandle
                        : `https://instagram.com/${instagramHandle.replace("@", "")}`
                    }
                    target='_blank'
                    class='btn-primary bg-gradient-to-r from-purple-500 to-pink-500 border-none'
                  >
                    Instagram {index === 0 ? "Lautaro" : "Gustty"}
                  </a>
                ))
              ) : (
                <a
                  href={
                    artist.socialMedia.instagram.startsWith("http")
                      ? artist.socialMedia.instagram
                      : `https://instagram.com/${artist.socialMedia.instagram.replace("@", "")}`
                  }
                  target='_blank'
                  class='btn-primary bg-gradient-to-r from-purple-500 to-pink-500 border-none'
                >
                  Instagram
                </a>
              ))
          }
          {
            artist.socialMedia.youtube &&
              artist.socialMedia.youtube.trim() !== "" && (
                <a
                  href={artist.socialMedia.youtube}
                  target='_blank'
                  class='btn-primary bg-red-600 border-none hover:bg-red-700'
                >
                  YouTube
                </a>
              )
          }
        </div>
      </div>
    </section>

    <!-- Content Section -->
    <section class='section-bg section'>
      <div class='container'>
        <div class='max-w-6xl mx-auto'>
          <!-- Título principal de la sección -->
          <div class='text-center mb-12'>
            <h2 class='font-title text-4xl md:text-5xl text-[--color-ink] mb-4'>
              Conocé a {artist.name}
            </h2>
            <div
              class='w-24 h-1 bg-gradient-to-r from-[--color-primary] to-[--color-accent] mx-auto rounded-full'
            >
            </div>
          </div>

          <!-- Grid principal -->
          <div class='grid gap-8'>
            <!-- Columna principal: Descripción -->
            <div class='lg:col-span-2'>
              <div
                class='bg-white/90 backdrop-blur-sm rounded-2xl p-8 shadow-xl border border-[--color-wood-light]/20'
              >
                <h3
                  class='font-title text-4xl text-[--color-ink] mb-6 flex flex-col items-center justify-center text-center'
                >
                  Su Historia
                </h3>
                <p
                  class='font-ui text-lg leading-relaxed text-[--color-ink]/80 mb-6'
                >
                  {artist.description}
                </p>
              </div>
            </div>

            <!-- Columna lateral: Info Cards -->
            <div class='space-y-6'>
              <!-- Card de Horario (si existe) -->
              {
                artist.showTime && (
                  <div class='bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-xl border border-[--color-wood-light]/20'>
                    <div class='flex items-center gap-3 mb-4'>
                      <div class='w-10 h-10 bg-gradient-to-br from-[--color-accent] to-[--color-accent]/70 rounded-full flex items-center justify-center'>
                        <svg
                          class='w-5 h-5 text-white'
                          fill='currentColor'
                          viewBox='0 0 20 20'
                        >
                          <path
                            fill-rule='evenodd'
                            d='M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z'
                            clip-rule='evenodd'
                          />
                        </svg>
                      </div>
                      <h4 class='font-title text-lg font-bold text-[--color-ink]'>
                        Horario
                      </h4>
                    </div>
                    <p class='font-ui text-[--color-ink]/80 text-lg font-medium'>
                      {artist.showTime}
                    </p>
                  </div>
                )
              }
            </div>
          </div>

          <!-- Video Section -->
          {
            artist.video && (
              <div class='mt-12'>
                <div class='bg-white/90 backdrop-blur-sm rounded-2xl p-8 shadow-xl border border-[--color-wood-light]/20'>
                  <div class='text-center mb-8'>
                    <h3 class='font-title text-3xl text-[--color-ink] mb-4 flex items-center justify-center gap-3'>
                      <svg
                        class='w-8 h-8 text-[--color-primary]'
                        fill='currentColor'
                        viewBox='0 0 20 20'
                      >
                        <path
                          fill-rule='evenodd'
                          d='M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z'
                          clip-rule='evenodd'
                        />
                      </svg>
                      Mirá a {artist.name} en acción
                    </h3>
                    <div class='w-24 h-1 bg-gradient-to-r from-[--color-primary] to-[--color-accent] mx-auto rounded-full' />
                  </div>

                  <div class='aspect-video rounded-xl overflow-hidden shadow-2xl border-4 border-white/50'>
                    <iframe
                      src={artist.video}
                      title={`Video de ${artist.name}`}
                      frameborder='0'
                      allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share'
                      allowfullscreen
                      class='w-full h-full'
                    />
                  </div>
                </div>
              </div>
            )
          }
        </div>
      </div>
    </section>
  </main>
</Layout>
